import { component } from "lively.morphic/index.js";
import { pt } from "lively.graphics/geometry-2d.js";
import { HTMLMorph } from "lively.morphic/html-morph.js";
const modules = component({
  type: HTMLMorph,
  name: 'aMarkdownPreviewMorph',
  extent: pt(420,15013.7),
  fixedHeight: false,
  html: '<div class=\"markdown-body\" style=\"margin: 5px\">\n\
<blockquote>\n\
<p>⚠️ <strong>Attention</strong></p>\n\
<p>The following article is of very technical nature and only suitable for people who are interested in learning more about the inner workings of <code>lively.next</code>.</p>\n\
</blockquote>\n\
<p class=\"markdown-line-marker\" data-mdline=\"5\" data-htmlline=\"6\"><code>lively.next</code> draws inspiration from Smalltalk, aiming to provide a flexible, efficient, and interactive coding experience. The following chapter outlines the key features and mechanisms of <code>lively.next</code>, highlighting its advanced class management, source transformations, module system, performance optimizations for loading the system, and bundling techniques.</p>\n\
<h2 class=\"markdown-line-marker\" data-mdline=\"8\" data-htmlline=\"9\">Transpilation in lively.next</h2>\n\
<p class=\"markdown-line-marker\" data-mdline=\"10\" data-htmlline=\"11\">Since <code>lively.next</code> lives in the Browser and <code>Node.JS</code> run-times, it does not have the luxury of a pure Smalltalk system where scopes and run-time stacks are first class objects or mutable classes are already built into the system core. Instead we need to tweak the default behavior of <code>JavaScript</code> with a little sprinkle of transpilation magic. ✨</p>\n\
<h3 class=\"markdown-line-marker\" data-mdline=\"12\" data-htmlline=\"13\">Scope</h3>\n\
<p class=\"markdown-line-marker\" data-mdline=\"14\" data-htmlline=\"15\">The first area of concern are evaluation scopes. In <code>JavaScript</code> a scope is defined syntactically but cannot be accessed easily programmatically after the fact, especially not in the browser. For instance, evaluating variable declaration like <code>var foo = \"bar\";</code> manually will simply populate the namespace the evaluation took place in. So we can not actually control which namespace the variables are populating. Likewise, we cannot access variables from other scopes unless we have them explicitly stored away in a dedicated object that we can pass around or access globally.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"16\" data-htmlline=\"18\">This is especially troubling when considering tools like the <strong>Workspace</strong> or the <strong>System Browser</strong>, where we operate on a module scope and would like to have the ability to flexibly evaluate expressions within the context of the module.\n\
To alleviate that, <code>lively.next</code> provides a scope capturing transpilation for modules that is transparent to the user. It covers:</p>\n\
<ul>\n\
<li>Class declarations.</li>\n\
<li>Function declarations.</li>\n\
<li>Constants, or other top level variables, especially <em>Component Definitions</em>.</li>\n\
</ul>\n\
<p class=\"markdown-line-marker\" data-mdline=\"23\" data-htmlline=\"24\">These entities inside of the written source-code are then rewritten to be captured by a synthesized recording object that keeps all declared variables stored transparent to the user. So a module scope that on the surface looks something like this:</p>\n\
<pre><code class=\"language-javascript hljs\" data-highlighted=\"yes\"><span class=\"hljs-keyword\">const</span> foo = <span class=\"hljs-string\">\'bar\'</span>;\n\
\n\
<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">alice</span>(<span class=\"hljs-params\"></span>) { returns <span class=\"hljs-string\">\'bob\'</span> }\n\
</code></pre>\n\
<p class=\"markdown-line-marker\" data-mdline=\"31\" data-htmlline=\"32\">Internally turns into something like the following:</p>\n\
<pre><code class=\"language-javascript hljs\" data-highlighted=\"yes\"><span class=\"hljs-keyword\">const</span> foo = __rec.<span class=\"hljs-property\">foo</span> = <span class=\"hljs-string\">\'bar\'</span>;\n\
\n\
__rec.<span class=\"hljs-property\">alice</span> = <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">alice</span>(<span class=\"hljs-params\"></span>) { returns <span class=\"hljs-string\">\'bob\'</span> }\n\
<span class=\"hljs-comment\">// also attach meta information to functions</span>\n\
__rec.<span class=\"hljs-property\">alice</span>[<span class=\"hljs-title class_\">Symbol</span>.<span class=\"hljs-title function_\">for</span>(<span class=\"hljs-string\">\'lively-module-meta\'</span>)] = {\n\
  sourceLocation,\n\
  <span class=\"hljs-attr\">package</span>: { <span class=\"hljs-variable language_\">module</span> }\n\
  ....\n\
}\n\
</code></pre>\n\
<p class=\"markdown-line-marker\" data-mdline=\"45\" data-htmlline=\"46\">Without going into too much detail, there are also more advanced scope capturing transformations. For instance in the presence of destructuring declarations the following happens:</p>\n\
<pre><code class=\"language-javascript hljs\" data-highlighted=\"yes\"><span class=\"hljs-keyword\">const</span> { ...bar, key } = foo;\n\
\n\
<span class=\"hljs-comment\">// is transformed to:</span>\n\
<span class=\"hljs-keyword\">let</span> destructured_1 = {\n\
  <span class=\"hljs-attr\">key</span>: <span class=\"hljs-number\">42</span>,\n\
  <span class=\"hljs-attr\">hello</span>: <span class=\"hljs-string\">\"foo\"</span>,\n\
  <span class=\"hljs-attr\">world</span>: <span class=\"hljs-string\">\"bar\"</span>\n\
};\n\
__rec.<span class=\"hljs-property\">key</span> = destructured_1.<span class=\"hljs-property\">key</span>;\n\
<span class=\"hljs-keyword\">var</span> bar = __rec.<span class=\"hljs-property\">bar</span> = {};\n\
<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> __key <span class=\"hljs-keyword\">in</span> destructured_1) {\n\
  <span class=\"hljs-keyword\">if</span> (__key === <span class=\"hljs-string\">\"key\"</span>)\n\
    <span class=\"hljs-keyword\">continue</span>;\n\
  bar[__key] = destructured_1[__key];\n\
}\n\
</code></pre>\n\
<h3 class=\"markdown-line-marker\" data-mdline=\"65\" data-htmlline=\"66\">Classes</h3>\n\
<p class=\"markdown-line-marker\" data-mdline=\"67\" data-htmlline=\"68\">The objective of <code>lively.next</code>s class system is to replicate a Smalltalk-like class object within its run-time. In Smalltalk, when a class definition is modified, the change is applied in place, allowing all instances of the class to immediately reflect the updated behavior. In contrast, <code>JavaScript</code>’s default behavior, whether using the new ECMAScript class syntax or the traditional function prototype approach, replaces the existing class with the new definition. To achieve a Smalltalk-like system with live updates in <code>lively.next</code>, it’s essential to alter this default evaluation method.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"69\" data-htmlline=\"70\">To ensure that redefining a class does not replace the existing class instance but instead patches it with the new definition, the classes are transformed into a function call that synthesizes a new class based on a preexisting version and includes the necessary class members, such as methods and static methods and getters.</p>\n\
<pre><code class=\"language-javascript hljs\" data-highlighted=\"yes\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Foo</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">SuperFoo</span> {\n\
  <span class=\"hljs-title function_\">m</span>(<span class=\"hljs-params\"></span>) { <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">2</span> + <span class=\"hljs-variable language_\">super</span>.<span class=\"hljs-title function_\">m</span>() }\n\
}\n\
\n\
<span class=\"hljs-comment\">// is converted into something like:</span>\n\
 <span class=\"hljs-title function_\">createOrExtend</span>(recorder, {<span class=\"hljs-attr\">referencedAs</span>: <span class=\"hljs-string\">\"SuperFoo\"</span>, <span class=\"hljs-attr\">value</span>: <span class=\"hljs-title class_\">SuperFoo</span>}, <span class=\"hljs-string\">\"Foo2\"</span>, [{\n\
   <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">\"m\"</span>,\n\
   <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">m</span>(<span class=\"hljs-params\"></span>) {\n\
     <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">2</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">constructor</span>[superclassSymbol].<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">m</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>);\n\
   }\n\
 }])\n\
</code></pre>\n\
<p class=\"markdown-line-marker\" data-mdline=\"85\" data-htmlline=\"86\">The <code>createOrExtend</code> function in the above transformation consequently checks if a class object is already present in the scope recorder and if so, continues to extend the class instead of replacing it.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"87\" data-htmlline=\"89\">Additionally, the class object needs to be equipped with meta-information about itself, including details about its properties, superclass, module it is defined in, and package it belongs to.\n\
Meta information about the properties within classes can be derived by using a canonical <code>static get properties() { }</code> definition, allowing for declarative property definitions. This setup facilitates the specification of property dependencies, default values, custom initialization routines, and other helpful meta-information for tool inspection, such as type and read-only status. Below is a schematic overview of how such a definition can look like:</p>\n\
<pre><code class=\"language-javascript hljs\" data-highlighted=\"yes\"><span class=\"hljs-comment\">// example of a class definition with static properties</span>\n\
<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Foo</span>  <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">SuperFoo</span> {\n\
  <span class=\"hljs-keyword\">static</span> get properties () {\n\
    <span class=\"hljs-keyword\">return</span> {\n\
       <span class=\"hljs-attr\">caption</span>: {\n\
          <span class=\"hljs-attr\">defaultValue</span>: <span class=\"hljs-string\">\'Default caption\'</span>, <span class=\"hljs-comment\">// does not invoke the setter when initialized to this value</span>\n\
          <span class=\"hljs-title function_\">initialize</span>(<span class=\"hljs-params\">v</span>) {\n\
            <span class=\"hljs-comment\">// passed the defaultValue as the first argument if defined</span>\n\
          }\n\
          <span class=\"hljs-title function_\">set</span>(<span class=\"hljs-params\">v</span>) {\n\
            <span class=\"hljs-comment\">// allows to override the default setter</span>\n\
          },\n\
          <span class=\"hljs-title function_\">get</span>(<span class=\"hljs-params\"></span>) {\n\
            <span class=\"hljs-comment\">// allows to override the default getter</span>\n\
          },\n\
          <span class=\"hljs-attr\">before</span>: [...], <span class=\"hljs-comment\">// list of properties that have to be initialized before</span>\n\
          <span class=\"hljs-attr\">after</span>: [...] <span class=\"hljs-comment\">// list of properties that can be initialized after </span>\n\
          ...\n\
       },\n\
       ...\n\
    }\n\
  }\n\
}\n\
</code></pre>\n\
<blockquote>\n\
<p><strong>💡 Tip</strong></p>\n\
<p>Remembering this concept of <code>static get properties() { }</code> is important, for example when working with <code>ViewModel</code>s. See our <a href=\"#documentation/morphic\" target=\"_blank\">introduction</a> to working with <code>ViewModel</code>s.</p>\n\
</blockquote>\n\
<p class=\"markdown-line-marker\" data-mdline=\"120\" data-htmlline=\"121\">Every other piece of meta information on the other hand is generated during transpilation since the transpiler has all the meta information at hand already so that it can be attached to the initialized class. It is then passed to the <code>createOrExtent()</code> function from earlier like so:</p>\n\
<pre><code class=\"language-javascript hljs\" data-highlighted=\"yes\"> <span class=\"hljs-title function_\">createOrExtend</span>(recorder, {<span class=\"hljs-attr\">referencedAs</span>: <span class=\"hljs-string\">\"SuperFoo\"</span>, <span class=\"hljs-attr\">value</span>: <span class=\"hljs-title class_\">SuperFoo</span>}, <span class=\"hljs-string\">\"Foo2\"</span>, [{\n\
   <span class=\"hljs-attr\">key</span>: <span class=\"hljs-string\">\"m\"</span>,\n\
   <span class=\"hljs-attr\">value</span>: <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">m</span>(<span class=\"hljs-params\"></span>) {\n\
     <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">2</span> + <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">constructor</span>[superclassSymbol].<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">m</span>.<span class=\"hljs-title function_\">call</span>(<span class=\"hljs-variable language_\">this</span>);\n\
   }\n\
 }], {\n\
   <span class=\"hljs-attr\">package</span>: { <span class=\"hljs-variable language_\">module</span> },\n\
   sourceLocation,\n\
   ...\n\
 })\n\
</code></pre>\n\
<h3 class=\"markdown-line-marker\" data-mdline=\"135\" data-htmlline=\"136\">Dynamic Code Evaluation</h3>\n\
<p class=\"markdown-line-marker\" data-mdline=\"137\" data-htmlline=\"138\">In Smalltalk-like systems, a crucial feature is the pervasive capability to evaluate expressions. This concept is rooted in the influences of <code>LISP</code>-like systems from which Smalltalk drew inspiration. In <code>JavaScript</code>, the standard <code>eval()</code> function has a number of peculiarities that can complicate its practical use. Notably, the evaluation context is tied to the local scope of the function from which it was invoked, as mentioned previously. Additionally, there are several other specific rules and behaviors associated with <code>eval()</code>, which are outlined in detail on resources like the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval\" target=\"_blank\">Mozilla Developer Network</a>.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"139\" data-htmlline=\"140\">To address these limitations, the <code>lively.next</code> framework offers a custom wrapper around <code>JavaScript</code>’s native <code>eval()</code> function. This wrapper applies unique source transformations, thereby providing a more predictable and flexible evaluation behavior. It allows for custom bindings to be provided alongside the code being evaluated, offering various styles of evaluation:</p>\n\
<ol>\n\
<li>\n\
<p><strong>Custom Variable Mapping Evaluation</strong>: This allows variables in the expression to be manually assigned specific values, enabling tailored execution contexts.</p>\n\
</li>\n\
<li>\n\
<p><strong>Module-Based Evaluation</strong>: Here, the variables of a module scope captured during custom transpilation are made available to the expression. This setup also supports the evaluation of partial module-specific expressions, such as <code>import</code> or <code>export</code> statements. This functionality is not available with the native <code>eval()</code> and is achieved by transforming module-specific syntax into statements that correctly access values from the module’s <code>recorder</code> object.</p>\n\
</li>\n\
<li>\n\
<p><strong>Remote run-time Evaluation</strong>: This environment supports evaluation in separate run-times, such as different browsers, servers, or <code>lively.next</code> instances running on different hardware. The source transpilation process ensures that all necessary modules and packages are imported, enabling the evaluation to proceed smoothly in the different environment. Remote evaluation can both be performed on per module basis or custom variable mapping, as explained before.</p>\n\
</li>\n\
</ol>\n\
<h2 class=\"markdown-line-marker\" data-mdline=\"147\" data-htmlline=\"148\">Modules in lively.next</h2>\n\
<p class=\"markdown-line-marker\" data-mdline=\"149\" data-htmlline=\"150\">The modules system in <code>lively.next</code> is its own spin on the now widely adopted <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules\" target=\"_blank\">EcmaScript Module System</a>. It provides a fully reflective interpretation of the former, allowing for run-time inspection and modification of each and every modules in the system. In the following we will go over the different technical bits that play a key role in its implementation.</p>\n\
<blockquote>\n\
<p><strong>📜 Behind the Scenes</strong></p>\n\
<p>Some of the spins on the native module system have historical reasons, as <code>lively.next</code> adopted this before its comprehensive success was a done deal. For this reason, we also use our own package abstraction, something that is still quite unique. As deviating from the widely-adopted best-practices in this way comes with some downsides, especially additional maintenance work, we are investigating solutions that build more on well-treated paths.</p>\n\
</blockquote>\n\
<h3 class=\"markdown-line-marker\" data-mdline=\"155\" data-htmlline=\"156\"><code>SystemJS</code></h3>\n\
<p class=\"markdown-line-marker\" data-mdline=\"157\" data-htmlline=\"158\"><a href=\"https://github.com/systemjs/systemjs\" target=\"_blank\"><code>SystemJS</code></a> is a framework that was developed in parallel with the early drafts of the EcmaScript Module System proposal. Over time, it has consistently aligned with the evolving semantics and changes of the standard, adapting through various iterations until the standard reached its current form. The core idea behind <code>SystemJS</code> was to offer a functional implementation of the standard as early as possible, thereby facilitating the adoption of JavaScript modules across the broader JavaScript ecosystem.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"159\" data-htmlline=\"160\">Given that native syntax support for modules was not yet available in browsers during its inception, <code>SystemJS</code> provided an alternative programmatic format that was semantically equivalent to the ECMAScript Module (ESM) System. This was complemented by an easily adaptable transpilation interface, enabling developers to convert ESM syntax into a format compliant with <code>SystemJS</code>.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"161\" data-htmlline=\"162\">Today, <code>SystemJS</code> is particularly valuable for the dynamic development of <code>JavaScript</code> module-based applications. It includes a convenient hot-swapping engine that allows for a dynamic live development in the browser.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"163\" data-htmlline=\"164\">In the case of the <code>lively.next</code> framework, <code>SystemJS</code> serves as the foundation for implementing various custom features that native <code>JavaScript</code> modules do not support. This is accomplished by integrating the aforementioned custom transpilation logic as a plugin into <code>SystemJS</code>. In addition to the unique transformations specific to <code>lively.next</code>, we also perform a final transpilation step to transpile the ESM module syntax into a format that <code>SystemJS</code> can process. The transpiled module code is then managed by <code>SystemJS</code>, which handles the necessary bookkeeping to ensure the proper functioning of the module system.</p>\n\
<div id=\"mermaid-container-7c37d23e65e646cba3659077675b9a57\"><svg aria-roledescription=\"flowchart-v2\" role=\"graphics-document document\" viewBox=\"-8 -8 282.6484375 322\" style=\"max-width: 282.6484375px;\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"mermaid-svg-2ae58fbd153049a5b767a04617666d5b\"><style>#mermaid-svg-2ae58fbd153049a5b767a04617666d5b{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .error-icon{fill:#552222;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .marker{fill:#333333;stroke:#333333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .marker.cross{stroke:#333333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b svg{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .label{font-family:\"trebuchet ms\",verdana,arial,sans-serif;color:#333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .cluster-label text{fill:#333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .cluster-label span,#mermaid-svg-2ae58fbd153049a5b767a04617666d5b p{color:#333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .label text,#mermaid-svg-2ae58fbd153049a5b767a04617666d5b span,#mermaid-svg-2ae58fbd153049a5b767a04617666d5b p{fill:#333;color:#333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .node rect,#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .node circle,#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .node ellipse,#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .node polygon,#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .flowchart-label text{text-anchor:middle;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .node .label{text-align:center;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .node.clickable{cursor:pointer;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .arrowheadPath{fill:#333333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .cluster text{fill:#333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .cluster span,#mermaid-svg-2ae58fbd153049a5b767a04617666d5b p{color:#333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-svg-2ae58fbd153049a5b767a04617666d5b :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}</style><g><marker orient=\"auto\" markerHeight=\"12\" markerWidth=\"12\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"6\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-2ae58fbd153049a5b767a04617666d5b_flowchart-pointEnd\"><path style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 0 0 L 10 5 L 0 10 z\"></path></marker><marker orient=\"auto\" markerHeight=\"12\" markerWidth=\"12\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"4.5\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-2ae58fbd153049a5b767a04617666d5b_flowchart-pointStart\"><path style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 0 5 L 10 10 L 10 0 z\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"11\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-2ae58fbd153049a5b767a04617666d5b_flowchart-circleEnd\"><circle style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"-1\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-2ae58fbd153049a5b767a04617666d5b_flowchart-circleStart\"><circle style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"12\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart\" id=\"mermaid-svg-2ae58fbd153049a5b767a04617666d5b_flowchart-crossEnd\"><path style=\"stroke-width: 2; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"-1\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart\" id=\"mermaid-svg-2ae58fbd153049a5b767a04617666d5b_flowchart-crossStart\"><path style=\"stroke-width: 2; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><g class=\"root\"><g class=\"clusters\"></g><g class=\"edgePaths\"><path marker-end=\"url(#mermaid-svg-2ae58fbd153049a5b767a04617666d5b_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-esm LE-custom\" id=\"L-esm-custom-0\" d=\"M133.324,39L133.324,43.167C133.324,47.333,133.324,55.667,133.324,63.117C133.324,70.567,133.324,77.133,133.324,80.417L133.324,83.7\"></path><path marker-end=\"url(#mermaid-svg-2ae58fbd153049a5b767a04617666d5b_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-custom LE-format\" id=\"L-custom-format-0\" d=\"M133.324,128L133.324,132.167C133.324,136.333,133.324,144.667,133.324,152.117C133.324,159.567,133.324,166.133,133.324,169.417L133.324,172.7\"></path><path marker-end=\"url(#mermaid-svg-2ae58fbd153049a5b767a04617666d5b_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-format LE-system\" id=\"L-format-system-0\" d=\"M133.324,217L133.324,221.167C133.324,225.333,133.324,233.667,133.324,241.117C133.324,248.567,133.324,255.133,133.324,258.417L133.324,261.7\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(133.32421875, 19.5)\" data-id=\"esm\" data-node=\"true\" id=\"flowchart-esm-0\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"157.2890625\" y=\"-19.5\" x=\"-78.64453125\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-71.14453125, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"142.2890625\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">ESMModule Source</span></div></foreignObject></g></g><g transform=\"translate(133.32421875, 108.5)\" data-id=\"custom\" data-node=\"true\" id=\"flowchart-custom-1\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"234.3515625\" y=\"-19.5\" x=\"-117.17578125\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-109.67578125, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"219.3515625\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Custom lively.next transpilation</span></div></foreignObject></g></g><g transform=\"translate(133.32421875, 197.5)\" data-id=\"format\" data-node=\"true\" id=\"flowchart-format-2\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"266.6484375\" y=\"-19.5\" x=\"-133.32421875\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-125.82421875, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"251.6484375\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">System.register format transpilation</span></div></foreignObject></g></g><g transform=\"translate(133.32421875, 286.5)\" data-id=\"system\" data-node=\"true\" id=\"flowchart-system-3\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"87.015625\" y=\"-19.5\" x=\"-43.5078125\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-36.0078125, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"72.015625\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">SystemJS</span></div></foreignObject></g></g></g></g></g></svg></div><h3 class=\"markdown-line-marker\" data-mdline=\"175\" data-htmlline=\"176\">Modules and Files</h3>\n\
<p class=\"markdown-line-marker\" data-mdline=\"177\" data-htmlline=\"178\">In essence, modules are ultimately based on files that are stored somewhere on a computer. For the core modules of <code>lively.next</code> (such as <code>lively.modules</code>, <code>lively.morphic</code>, etc.), these files are located within the local file system where the <code>lively.server</code> is running. By default, <code>lively.next</code> requests these source files from the server, which retrieves the files and sends their contents back to the client. When a module is modified from the client side, the corresponding file is eventually updated in the file system.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"179\" data-htmlline=\"180\">However these are not the only types of modules we use. There are broadly four types of modules encountered in <code>lively.next</code>:</p>\n\
<ol>\n\
<li>\n\
<p><strong>Core Modules</strong>: These are part of the core packages of <code>lively.next</code>. These modules can be modified to evolve the system at run-time.</p>\n\
</li>\n\
<li>\n\
<p><strong>Project-Specific Modules</strong>: These are modules related to projects currently being developed in <code>lively.next</code>. You are very welcome to edit these modules of course! These are all files that reside in a folder inside of the <code>local_projects</code> folder in your <code>lively.next</code> repository.</p>\n\
</li>\n\
<li>\n\
<p><strong>Third-Party Modules via <code>flatn</code></strong>: These modules are installed through the custom NPM package manager <a href=\"https://github.com/rksm/flatn\" target=\"_blank\"><code>flatn</code></a>. Although technically modifiable, it is generally advised not to alter these modules. Many of these NPM packages do not ship as ECMAScript Modules (ESM) and can only be reliably used within a <code>Node.js</code> environment. This limitation arises because <code>lively.next</code> currently provides native fallbacks for non-ESM modules exclusively in the <code>Node.js</code> context. However, using native fallbacks results in a loss of reflection capabilities for these modules. For reliable import of third-party modules in the browser, a different approach is needed.</p>\n\
</li>\n\
<li>\n\
<p><strong>Third-Party Modules via Public ESM Transpilation Services</strong>: These are public servers that provide ESM-transpiled versions of NPM packages. This method enables approximately 90% of NPM packages intended for browser use to be imported directly into the browser. While there may be occasional bugs or issues, they can often be reported to the administrators of these servers, who are usually prompt in addressing the problems. To enhance loading performance, these modules are cached as files on the server file system of <code>lively.next</code>. Although technically possible, altering these modules is generally not recommended.</p>\n\
</li>\n\
</ol>\n\
<p class=\"markdown-line-marker\" data-mdline=\"189\" data-htmlline=\"190\">In addition to file-based modules, <code>lively.next</code> also supports in-memory modules. These can be stored in the browser’s local storage (<code>local://...</code>) or kept entirely in memory (<code>lively://...</code>), disappearing once the run-time is terminated. An example of these ephemeral modules includes those created by workspaces within the system. In memory modules can also be serialized, meaning they can be incorporated into a snapshot which can be handy to transport state and behavior across different systems. See our <a href=\"#documentation/projects\" target=\"_blank\">explanation on <code>lively.project</code>s</a> for some more information on snapshots.</p>\n\
<h3 class=\"markdown-line-marker\" data-mdline=\"191\" data-htmlline=\"192\">Bootstrapping the Module-System</h3>\n\
<p class=\"markdown-line-marker\" data-mdline=\"193\" data-htmlline=\"194\">In <code>lively.next</code>, modules are fully reflective, meaning each module object contains all the information it needs about its position within the system, the source code it holds, and the methods to update or reload itself. This level of introspection is not natively supported by either the Browser or the <code>NodeJS</code> run-time, making it essential to establish a bootstrapping process that initializes the module system before any module imports occur.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"195\" data-htmlline=\"196\">The bootstrapping process is meta-circular, meaning it is defined entirely within <code>lively.next</code>. Here’s a breakdown of the process:</p>\n\
<blockquote>\n\
<p><strong>📜 Behind the Scenes</strong></p>\n\
<p>Note, that the following describes the bootstrapping inside both the browser and <code>Node.JS</code>. There is a slight difference between the two: For step A we utilize the native module system in <code>Node.JS</code> to import the modules in a non reflective manner. As for the browser, we still rely on a bootstrapping bundle to perform the <em>initial import</em>. This used to be nessecary, since browsers did not support ES modules <em>at all</em> natively. Nowadays ES modules are supported, yet bundles still maintain a loading performance edge over ES modules especially for large projects, hence we still rely on using a bootstrapping bundle in the browser.</p>\n\
</blockquote>\n\
<p class=\"markdown-line-marker\" data-mdline=\"201\" data-htmlline=\"202\"><strong>Step A</strong> involves ensuring that all necessary third-party libraries, particularly <code>SystemJS</code> and <a href=\"https://babeljs.io/\" target=\"_blank\"><code>Babel</code></a>, are loaded first. These libraries are crucial for the functioning of the system. Note, that a future goal is to remove <code>Babel</code> and its extensive dependencies, as it is currently used only for ESM to <code>SystemJS</code> transpilation. After loading these libraries, all core packages required for the <code>lively.modules</code> package are imported, followed by the initialization of the <code>lively.modules</code> package itself.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"203\" data-htmlline=\"204\"><strong>Step B</strong> utilizes the now initialized <code>lively.modules</code> package to re-import the previously imported packages along with any remaining necessary packages. This re-importation process is critical to achieve a fully reflective state within the module system.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"205\" data-htmlline=\"206\">It is important to note that the code described in the steps above is not executable on its own because there needs to be an initial module system in place to start importing anything. This issue is resolved by bundling the bootstrapping algorithm, where the steps in <strong>Step A</strong> become static imports resolved by the bundler. This setup provides enough infrastructure to enable the actions described in <strong>Step B</strong>.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"207\" data-htmlline=\"208\">Here is a diagram illustrating the bootstrapping process:</p>\n\
<div id=\"mermaid-container-ae4fe48ccb10461c89bbc17da8c3b4ee\"><svg aria-roledescription=\"flowchart-v2\" role=\"graphics-document document\" viewBox=\"-8 -8 599.8125 729\" style=\"max-width: 599.8125px;\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"mermaid-svg-73a0e465d788467ea7920664650bc520\"><style>#mermaid-svg-73a0e465d788467ea7920664650bc520{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .error-icon{fill:#552222;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .marker{fill:#333333;stroke:#333333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .marker.cross{stroke:#333333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 svg{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .label{font-family:\"trebuchet ms\",verdana,arial,sans-serif;color:#333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .cluster-label text{fill:#333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .cluster-label span,#mermaid-svg-73a0e465d788467ea7920664650bc520 p{color:#333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .label text,#mermaid-svg-73a0e465d788467ea7920664650bc520 span,#mermaid-svg-73a0e465d788467ea7920664650bc520 p{fill:#333;color:#333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .node rect,#mermaid-svg-73a0e465d788467ea7920664650bc520 .node circle,#mermaid-svg-73a0e465d788467ea7920664650bc520 .node ellipse,#mermaid-svg-73a0e465d788467ea7920664650bc520 .node polygon,#mermaid-svg-73a0e465d788467ea7920664650bc520 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .flowchart-label text{text-anchor:middle;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .node .label{text-align:center;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .node.clickable{cursor:pointer;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .arrowheadPath{fill:#333333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-svg-73a0e465d788467ea7920664650bc520 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .cluster text{fill:#333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .cluster span,#mermaid-svg-73a0e465d788467ea7920664650bc520 p{color:#333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-73a0e465d788467ea7920664650bc520 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-svg-73a0e465d788467ea7920664650bc520 :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}</style><g><marker orient=\"auto\" markerHeight=\"12\" markerWidth=\"12\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"6\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-pointEnd\"><path style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 0 0 L 10 5 L 0 10 z\"></path></marker><marker orient=\"auto\" markerHeight=\"12\" markerWidth=\"12\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"4.5\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-pointStart\"><path style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 0 5 L 10 10 L 10 0 z\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"11\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-circleEnd\"><circle style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"-1\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-circleStart\"><circle style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"12\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart\" id=\"mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-crossEnd\"><path style=\"stroke-width: 2; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"-1\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart\" id=\"mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-crossStart\"><path style=\"stroke-width: 2; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><g class=\"root\"><g class=\"clusters\"></g><g class=\"edgePaths\"><path marker-end=\"url(#mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-s1 LE-A\" id=\"L-s1-A-0\" d=\"M244.844,39L244.844,43.167C244.844,47.333,244.844,55.667,244.844,63.117C244.844,70.567,244.844,77.133,244.844,80.417L244.844,83.7\"></path><path marker-end=\"url(#mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B\" id=\"L-A-B-0\" d=\"M360.453,356L366.947,363.5C373.442,371,386.432,386,392.927,400.117C399.422,414.233,399.422,427.467,399.422,434.083L399.422,440.7\"></path><path marker-end=\"url(#mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-C\" id=\"L-A-C-0\" d=\"M129.235,356L122.74,363.5C116.245,371,103.255,386,96.761,415.833C90.266,445.667,90.266,490.333,90.266,531.667C90.266,573,90.266,611,105.035,634.252C119.805,657.504,149.344,666.008,164.114,670.259L178.883,674.511\"></path><path marker-end=\"url(#mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C\" id=\"L-B-C-0\" d=\"M399.422,624L399.422,628.167C399.422,632.333,399.422,640.667,384.652,649.085C369.883,657.504,340.343,666.008,325.574,670.259L310.804,674.511\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g transform=\"translate(399.421875, 401)\" class=\"edgeLabel\"><g transform=\"translate(-74.70703125, -20)\" class=\"label\"><foreignObject style=\"width: 149.414px; height: 40px;\" height=\"40\" width=\"149.4140625\"><div style=\"display: table-cell; white-space: nowrap; max-width: 200px;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\">\n\
    <span class=\"nodeLabel\"><p>Reflective <em>Slow Load</em></p></span></div></foreignObject></g></g><g transform=\"translate(90.265625, 535)\" class=\"edgeLabel\"><g transform=\"translate(-90.265625, -20)\" class=\"label\"><foreignObject style=\"width: 180.531px; height: 40px;\" height=\"40\" width=\"180.53125\"><div style=\"display: table-cell; white-space: nowrap; max-width: 200px;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\">\n\
    <span class=\"nodeLabel\"><p>Non-Reflective <em>Fast Load</em></p></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(208.03125, 438)\" class=\"root\"><g class=\"clusters\"><g id=\"B\" class=\"cluster default flowchart-label\"><rect height=\"178\" width=\"367.78125\" y=\"8\" x=\"8\" ry=\"0\" rx=\"0\" style=\"\"></rect><g transform=\"translate(186.5546875, 8)\" class=\"cluster-label\"><foreignObject height=\"24\" width=\"10.671875\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">B</span></div></foreignObject></g></g></g><g class=\"edgePaths\"><path marker-end=\"url(#mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-b1 LE-b2\" id=\"L-b1-b2-0\" d=\"M191.891,72L191.891,76.167C191.891,80.333,191.891,88.667,191.891,96.117C191.891,103.567,191.891,110.133,191.891,113.417L191.891,116.7\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(191.890625, 141.5)\" data-id=\"b2\" data-node=\"true\" id=\"flowchart-b2-13\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"297.78125\" y=\"-19.5\" x=\"-148.890625\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-141.390625, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"282.78125\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Fully reflective module system prepared</span></div></foreignObject></g></g><g transform=\"translate(191.890625, 52.5)\" data-id=\"b1\" data-node=\"true\" id=\"flowchart-b1-12\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"279.6875\" y=\"-19.5\" x=\"-139.84375\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-132.34375, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"264.6875\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Re-Import modules via lively.modules</span></div></foreignObject></g></g></g></g><g transform=\"translate(92.5625, 81)\" class=\"root\"><g class=\"clusters\"><g id=\"A\" class=\"cluster default flowchart-label\"><rect height=\"267\" width=\"289.5625\" y=\"8\" x=\"8\" ry=\"0\" rx=\"0\" style=\"\"></rect><g transform=\"translate(147.4453125, 8)\" class=\"cluster-label\"><foreignObject height=\"24\" width=\"10.671875\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">A</span></div></foreignObject></g></g></g><g class=\"edgePaths\"><path marker-end=\"url(#mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-a1 LE-a2\" id=\"L-a1-a2-0\" d=\"M152.781,72L152.781,76.167C152.781,80.333,152.781,88.667,152.781,96.117C152.781,103.567,152.781,110.133,152.781,113.417L152.781,116.7\"></path><path marker-end=\"url(#mermaid-svg-73a0e465d788467ea7920664650bc520_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-a2 LE-a3\" id=\"L-a2-a3-0\" d=\"M152.781,161L152.781,165.167C152.781,169.333,152.781,177.667,152.781,185.117C152.781,192.567,152.781,199.133,152.781,202.417L152.781,205.7\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(152.78125, 230.5)\" data-id=\"a3\" data-node=\"true\" id=\"flowchart-a3-11\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"176.546875\" y=\"-19.5\" x=\"-88.2734375\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-80.7734375, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"161.546875\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Initialize lively.modules</span></div></foreignObject></g></g><g transform=\"translate(152.78125, 52.5)\" data-id=\"a1\" data-node=\"true\" id=\"flowchart-a1-9\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"219.5625\" y=\"-19.5\" x=\"-109.78125\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-102.28125, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"204.5625\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Load SystemJS and Babel.js</span></div></foreignObject></g></g><g transform=\"translate(152.78125, 141.5)\" data-id=\"a2\" data-node=\"true\" id=\"flowchart-a2-10\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"168.8515625\" y=\"-19.5\" x=\"-84.42578125\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-76.92578125, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"153.8515625\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Import core packages</span></div></foreignObject></g></g></g></g><g transform=\"translate(244.84375, 19.5)\" data-id=\"s1\" data-node=\"true\" id=\"flowchart-s1-8\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"141\" y=\"-19.5\" x=\"-70.5\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-63, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"126\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Launch lively.next</span></div></foreignObject></g></g><g transform=\"translate(244.84375, 693.5)\" data-id=\"C\" data-node=\"true\" id=\"flowchart-C-14\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"121.734375\" y=\"-19.5\" x=\"-60.8671875\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-53.3671875, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"106.734375\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Prepare Studio</span></div></foreignObject></g></g></g></g></g></svg></div><h3 class=\"markdown-line-marker\" data-mdline=\"232\" data-htmlline=\"233\">Fast vs Slow Loading</h3>\n\
<p class=\"markdown-line-marker\" data-mdline=\"234\" data-htmlline=\"235\">To optimize the startup performance of <code>lively.next</code>, we can adjust the approach to the bootstrapping process. Typically, around 10% of the boot time is spent on <strong>Step A</strong>, while the majority of the time is consumed by <strong>Step B</strong>. To enhance performance, we can choose how thoroughly to perform <strong>Step B</strong>, resulting in two different loading modes: <em>slow load</em> and <em>fast load</em>.</p>\n\
<h4 class=\"markdown-line-marker\" data-mdline=\"236\" data-htmlline=\"237\">Slow Load</h4>\n\
<p class=\"markdown-line-marker\" data-mdline=\"238\" data-htmlline=\"239\">In the slow loading mode, the system uses the bundled version to fully replace itself with a version of <code>lively.next</code> loaded through <code>lively.modules</code>. This process reloads each module object from scratch, creating a clean and complete network of modules where each module is treated as a first-class object managed by <code>SystemJS</code>. While this approach takes longer to load, it offers the most reliable way to enhance and modify the system internally, ensuring that all modules are up-to-date and correctly integrated.</p>\n\
<h4 class=\"markdown-line-marker\" data-mdline=\"240\" data-htmlline=\"241\">Fast Load</h4>\n\
<p class=\"markdown-line-marker\" data-mdline=\"242\" data-htmlline=\"243\">In contrast, the fast load mode aims to minimize the re-initialization of modules. It primarily uses the bundled version of <code>lively.next</code>, avoiding the complete reloading of all modules. Changes made to the system after the bundle are incorporated through a mechanism called <em>reviving modules</em>, which injects these updates into the existing bundled modules. However, the effectiveness of this approach can vary, and it is generally not recommended to have numerous local changes in place. <strong>The fast load mode is best suited for users who do not modify the core system</strong>.</p>\n\
<h3 class=\"markdown-line-marker\" data-mdline=\"244\" data-htmlline=\"245\">Caching Optimizations</h3>\n\
<p class=\"markdown-line-marker\" data-mdline=\"246\" data-htmlline=\"247\">To further optimize the loading performance in <strong>Step B</strong> of the <code>lively.next</code> bootstrapping process, we employ compression and caching strategies through the <code>SystemJS</code> plugin API. This API allows us to integrate directly into the module loading process, enhancing efficiency in two key ways: A server-side compression of the core source core and using client-side storage for immediate fetching.</p>\n\
<div id=\"mermaid-container-1c04a37f464d45b5a230ff153e0c3a21\"><svg aria-roledescription=\"flowchart-v2\" role=\"graphics-document document\" viewBox=\"-8 -8 490.865234375 527\" style=\"max-width: 490.865234375px;\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c\"><style>#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .error-icon{fill:#552222;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .marker{fill:#333333;stroke:#333333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .marker.cross{stroke:#333333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c svg{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .label{font-family:\"trebuchet ms\",verdana,arial,sans-serif;color:#333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .cluster-label text{fill:#333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .cluster-label span,#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c p{color:#333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .label text,#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c span,#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c p{fill:#333;color:#333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .node rect,#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .node circle,#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .node ellipse,#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .node polygon,#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .flowchart-label text{text-anchor:middle;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .node .label{text-align:center;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .node.clickable{cursor:pointer;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .arrowheadPath{fill:#333333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .cluster text{fill:#333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .cluster span,#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c p{color:#333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}</style><g><marker orient=\"auto\" markerHeight=\"12\" markerWidth=\"12\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"6\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-pointEnd\"><path style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 0 0 L 10 5 L 0 10 z\"></path></marker><marker orient=\"auto\" markerHeight=\"12\" markerWidth=\"12\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"4.5\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-pointStart\"><path style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 0 5 L 10 10 L 10 0 z\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"11\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-circleEnd\"><circle style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"-1\" viewBox=\"0 0 10 10\" class=\"marker flowchart\" id=\"mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-circleStart\"><circle style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"12\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart\" id=\"mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-crossEnd\"><path style=\"stroke-width: 2; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"-1\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart\" id=\"mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-crossStart\"><path style=\"stroke-width: 2; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><g class=\"root\"><g class=\"clusters\"><g id=\"Client\" class=\"cluster default flowchart-label\"><rect height=\"398\" width=\"474.865234375\" y=\"113\" x=\"0\" ry=\"0\" rx=\"0\" style=\"\"></rect><g transform=\"translate(216.9794921875, 113)\" class=\"cluster-label\"><foreignObject height=\"24\" width=\"40.90625\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Client</span></div></foreignObject></g></g><g id=\"storage\" class=\"cluster default flowchart-label\"><rect height=\"348\" width=\"253.927734375\" y=\"138\" x=\"200.9375\" ry=\"0\" rx=\"0\" style=\"\"></rect><g transform=\"translate(301.2177734375, 138)\" class=\"cluster-label\"><foreignObject height=\"24\" width=\"53.3671875\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">storage</span></div></foreignObject></g></g></g><g class=\"edgePaths\"><path marker-end=\"url(#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-S LE-sources\" id=\"L-S-sources-0\" d=\"M225.336,33.631L242.857,40.693C260.378,47.754,295.419,61.877,312.94,75.105C330.461,88.333,330.461,100.667,330.461,111C330.461,121.333,330.461,129.667,330.461,137.2C330.461,144.733,330.461,151.467,330.461,154.833L330.461,158.2\"></path><path marker-end=\"url(#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-S LE-modules\" id=\"L-S-modules-0\" d=\"M159.279,39L149.477,45.167C139.676,51.333,120.072,63.667,110.27,76C100.469,88.333,100.469,100.667,100.469,111C100.469,121.333,100.469,129.667,100.469,141.333C100.469,153,100.469,168,100.469,186.333C100.469,204.667,100.469,226.333,100.469,243.783C100.469,261.233,100.469,274.467,100.469,281.083L100.469,287.7\"></path><path marker-end=\"url(#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-modules LE-transpiled\" id=\"L-modules-transpiled-0\" d=\"M151.65,332L171.336,339.5C191.021,347,230.391,362,255.963,376.331C281.534,390.662,293.306,404.323,299.193,411.154L305.079,417.985\"></path><path marker-end=\"url(#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-sources LE-modules\" id=\"L-sources-modules-0\" d=\"M330.461,202.5L330.461,210.083C330.461,217.667,330.461,232.833,302.504,248.257C274.547,263.681,218.634,279.361,190.677,287.202L162.72,295.042\"></path><path marker-end=\"url(#mermaid-svg-d610eb8e270b4ecfb35298faa4effe6c_flowchart-pointEnd)\" style=\"fill:none;\" class=\"edge-thickness-normal edge-pattern-solid flowchart-link LS-transpiled LE-modules\" id=\"L-transpiled-modules-0\" d=\"M342.145,422L348.608,414.5C355.071,407,367.996,392,338.102,376.139C308.209,360.277,235.496,343.554,199.139,335.193L162.782,326.831\"></path></g><g class=\"edgeLabels\"><g transform=\"translate(330.4609375, 76)\" class=\"edgeLabel\"><g transform=\"translate(-100.046875, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"200.09375\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\">compressed module archive</span></div></foreignObject></g></g><g transform=\"translate(100.46875, 183)\" class=\"edgeLabel\"><g transform=\"translate(-80.46875, -20)\" class=\"label\"><foreignObject style=\"width: 160.938px; height: 40px;\" height=\"40\" width=\"160.9375\"><div style=\"display: table-cell; white-space: nowrap; max-width: 200px;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\">\n\
    <span class=\"nodeLabel\"><p><strong>3. per module source</strong></p></span></div></foreignObject></g></g><g transform=\"translate(269.76171875, 377)\" class=\"edgeLabel\"><g transform=\"translate(-40.4609375, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"80.921875\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\">write cache</span></div></foreignObject></g></g><g transform=\"translate(330.4609375, 248)\" class=\"edgeLabel\"><g transform=\"translate(-59.140625, -20)\" class=\"label\"><foreignObject style=\"width: 118.281px; height: 40px;\" height=\"40\" width=\"118.28125\"><div style=\"display: table-cell; white-space: nowrap; max-width: 200px;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\">\n\
    <span class=\"nodeLabel\"><p><strong>2. read memory</strong></p></span></div></foreignObject></g></g><g transform=\"translate(380.921875, 377)\" class=\"edgeLabel\"><g transform=\"translate(-50.69921875, -20)\" class=\"label\"><foreignObject style=\"width: 101.398px; height: 40px;\" height=\"40\" width=\"101.3984375\"><div style=\"display: table-cell; white-space: nowrap; max-width: 200px;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\">\n\
    <span class=\"nodeLabel\"><p><strong>1. read cache</strong></p></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(100.46875, 312.5)\" data-id=\"modules\" data-node=\"true\" id=\"flowchart-modules-32\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"114.296875\" y=\"-19.5\" x=\"-57.1484375\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-49.6484375, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"99.296875\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">lively.modules</span></div></foreignObject></g></g><g transform=\"translate(330.4609375, 183)\" data-id=\"sources\" data-node=\"true\" id=\"flowchart-sources-34\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"71.0234375\" y=\"-19.5\" x=\"-35.51171875\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-28.01171875, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"56.0234375\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">sources</span></div></foreignObject></g></g><g transform=\"translate(325.341796875, 441.5)\" data-id=\"transpiled\" data-node=\"true\" id=\"flowchart-transpiled-38\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"84.375\" y=\"-19.5\" x=\"-42.1875\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-34.6875, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"69.375\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">transpiled</span></div></foreignObject></g></g><g transform=\"translate(190.2734375, 19.5)\" data-id=\"S\" data-node=\"true\" id=\"flowchart-S-30\" class=\"node default default flowchart-label\"><rect height=\"39\" width=\"70.125\" y=\"-19.5\" x=\"-35.0625\" ry=\"0\" rx=\"0\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-27.5625, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"55.125\"><div style=\"display: inline-block; white-space: nowrap;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\">Servers</span></div></foreignObject></g></g></g></g></g></svg></div><h4 class=\"markdown-line-marker\" data-mdline=\"266\" data-htmlline=\"267\">Server-Side Compression of Core Source Code</h4>\n\
<p class=\"markdown-line-marker\" data-mdline=\"268\" data-htmlline=\"270\">By default, when loading a module, its source code is fetched <strong>via the server (3)</strong> (<em>in the diagram below</em>). This happens on a per module basis and is therefore relatively time consuming since it creates a lot of request overhead from the browser.\n\
To alleviate that, the server maintains a complete bundle of the entire <code>lively.next</code> core library code in a single <code>gzip</code>-compressed file. This bundle is created whenever the server starts or when any core module changes during development. By sending this bundle to the client at startup, we significantly reduce the overhead associated with multiple module requests, consolidating them into a single transfer. This method allows the system to <strong>read module sources directly from memory (2)</strong> during booting, accelerating the bootstrapping process.</p>\n\
<h4 class=\"markdown-line-marker\" data-mdline=\"271\" data-htmlline=\"272\">Transpilation and Client-Side Storage for Immediate Fetch</h4>\n\
<p class=\"markdown-line-marker\" data-mdline=\"273\" data-htmlline=\"274\">Besides optimizing the loading time of the source code itself, reducing the time spent on transpilation is crucial. In <code>lively.next</code>, almost every module that is to be edited and evaluated at run-time requires transpilation, which can be a time-consuming process. To mitigate this, we store each transpiled module in the local storage. On successive boots, the system can directly fetch and evaluate these modules <strong>from storage (1)</strong> rather than re-transpiling them, thereby saving time and resources.</p>\n\
<h3 class=\"markdown-line-marker\" data-mdline=\"275\" data-htmlline=\"276\">Hot Reloading</h3>\n\
<p class=\"markdown-line-marker\" data-mdline=\"277\" data-htmlline=\"278\">SystemJS maintains an internal record of module dependencies, which allows it to handle the reloading of necessary modules when one is updated at run-time. When a request is made to update or reload a module, the following steps occur in SystemJS:</p>\n\
<ol>\n\
<li>The record of the module is deleted from the SystemJS registry.</li>\n\
<li>The module is re-declared in its new or current form, depending on whether a complete reload or just a patch is required.</li>\n\
<li>An import of the module is triggered, which executes the module and updates the module record.</li>\n\
</ol>\n\
<p class=\"markdown-line-marker\" data-mdline=\"283\" data-htmlline=\"284\">Reloading a module essentially results in a complete re-evaluation of the module’s contents, which can reset all variables, objects, functions, and classes defined within it. To manage this, our custom transpilation process, as explained earlier, ensures that the code is structured to support successful run-time patching, preserving necessary state changes.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"285\" data-htmlline=\"286\">Regardless of whether a module is reloaded or updated, <code>lively.modules</code> detects any changes in the module’s exports and identifies the dependent modules affected by these changes. It then traverses these affected modules, forcing a re-execution of their compiled bodies to propagate the updated exports throughout the system if needed.</p>\n\
<h2 class=\"markdown-line-marker\" data-mdline=\"288\" data-htmlline=\"289\">Bundling in <code>lively.next</code></h2>\n\
<p class=\"markdown-line-marker\" data-mdline=\"290\" data-htmlline=\"291\">Smalltalk and similar systems typically require their applications to be shipped along with their run-times. For instance, running a Self application necessitates having Self installed, and running a Smalltalk app requires access to an image. This dependency issue is also present in <code>lively.next</code>, where the run-time needs to be instantiated in the browser. This process involves creating all the necessary objects to get the system operational, which can take a significant amount of time.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"292\" data-htmlline=\"293\">To ship applications effectively as web-apps for the browser, it is crucial to ensure that they load quickly and include only the essential components. This is a reasonable approach because most end users are unlikely to want to customize the application further. Even if customization is desired, it is fair to assume that users will be willing to wait for the system to load to incorporate the changes they need.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"294\" data-htmlline=\"295\">To address these needs, <code>lively.next</code> features a comprehensive bundling system. This system creates compact bundles of applications, including only the necessary code and avoiding the costly initialization of the module system. The bundler operates as a custom <a href=\"https://rollupjs.org/\" target=\"_blank\"><code>RollupJS</code></a> plugin.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"296\" data-htmlline=\"297\">The resulting bundle utilizes the <a href=\"https://github.com/systemjs/systemjs/blob/main/docs/system-register.md\" target=\"_blank\">System.register() module format</a>. This format allows for lazy loading of code chunks, which improves the initial load time for applications that use a wide range of <code>lively.next</code> functionalities, such as <em>interactive essays</em>.</p>\n\
<p class=\"markdown-line-marker\" data-mdline=\"298\" data-htmlline=\"299\">When you create a project, <code>lively.next</code> will automatically generate the necessary build scripts for you, so that you can invoke them easily by running <code>npm run build</code> from the console. More information can be found in our <a href=\"#documentation/projects\" target=\"_blank\">guide to <code>lively.project</code>s</a>.</p>\n\
\n\
</div>',
  layout: null,
  position: pt(750,297)
});



export { modules }